"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = {
  //格式化日期 "yyyy-MM-dd hh:mm:ss"
  dateFormat: function dateFormat(fmt, date) {
    var o = {
      "M+": date.getMonth() + 1, //月份   
      "d+": date.getDate(), //日   
      "h+": date.getHours(), //小时   
      "m+": date.getMinutes(), //分   
      "s+": date.getSeconds(), //秒   
      "q+": Math.floor((date.getMonth() + 3) / 3), //季度   
      "S": date.getMilliseconds() //毫秒   
    };
    if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (date.getFullYear() + "").substr(4 - RegExp.$1.length));
    for (var k in o) {
      if (new RegExp("(" + k + ")").test(fmt)) fmt = fmt.replace(RegExp.$1, RegExp.$1.length == 1 ? o[k] : ("00" + o[k]).substr(("" + o[k]).length));
    }return fmt;
  },


  //获取一周的时间
  getWeekList: function getWeekList(fmt, date) {
    var dateTime = date.getTime(); // 获取现在的时间
    var dateDay = date.getDay(); //星期
    var oneDayTime = 24 * 60 * 60 * 1000; //一天的时间
    var startDateTime = dateTime - oneDayTime * dateDay;
    var weeklist = [];
    for (var i = 0; i < 7; i++) {
      var time = startDateTime + i * oneDayTime;
      weeklist[i] = this.dateFormat(fmt, new Date(time));
    }
    return weeklist;
  },


  /**
   * 
   * 获取一个月的天数
   */

  getCountDays: function getCountDays(curDate) {
    /* 获取当前月份 */
    var curMonth = this.getMonth(curDate);
    var curYear = this.getYear(curDate);
    console.log('&&&&&');
    console.log(curDate);
    console.log(curMonth);
    console.log(curYear);
    console.log(new Date(curYear, curMonth, 0).getDate());

    return new Date(curYear, curMonth, 0).getDate();
    /*  生成实际的月份: 由于curMonth会比实际月份小1, 故需加1 */
    // curDate.setMonth(curMonth + 1);
    /* 将日期设置为0, 这里为什么要这样设置, 我不知道原因, 这是从网上学来的 */
    // curDate.setDate(0);
    /* 返回当月的天数 */
    // return curDate.getDate();
  },


  /**
   * 获取某月第一天是周几
   */
  getDate: function getDate(year, month) {
    var nowdate = new Date(year, month - 1, 1);
    return nowdate.getDay();
  },


  /*
   *获取月份
   */
  getMonth: function getMonth(date) {
    var pur_date = date ? date : new Date();
    return pur_date.getMonth() + 1;
  },


  /**
   * 
   * 获取年份
   */

  getYear: function getYear(date) {
    var pur_date = date ? date : new Date();
    return pur_date.getFullYear();
  },
  getWeek: function getWeek(date) {
    var pur_date = date ? date : new Date();
    return pur_date.getDay();
  },


  //通过时间点获取该月的每天
  getMonthEveryDay: function getMonthEveryDay(date) {
    var pru_date = date ? date : new Date();
    // console.log('当前月日期：');
    // console.log(pru_date);
    var mon = this.getMonth(pru_date);
    var year = this.getYear(pru_date);
    var start = this.getDate(year, mon); //第一天的星期
    var count = this.getCountDays(pru_date); //当月总数
    console.log(pru_date);
    // console.log(mon);
    // console.log(year);
    // console.log(start);
    // console.log(count);

    var preMonthDate = this.getPreMonth(this.dateFormat('yyyy-MM-dd', pru_date)); //上一个月的最后一天
    console.log(preMonthDate);

    var pre_month_count = this.getCountDays(new Date(preMonthDate.replace(/-/g, "/"))); //上个月的天数
    var pre_month_day = new Date(preMonthDate.replace(/-/g, "/"));
    var pre_month_year = this.getYear(pre_month_day);
    var pre_month_month = this.getMonth(pre_month_day);
    // console.log('上');
    // console.log(preMonthDate);
    // console.log(pre_month_count);
    // console.log(pre_month_day);
    // console.log(pre_month_year+'年');
    // console.log(pre_month_month+'月');

    var nextMonthDate = this.getNextMonth(this.dateFormat('yyyy-MM-dd', pru_date));
    console.log(nextMonthDate);
    var next_month_day = new Date(nextMonthDate.replace(/-/g, "/"));
    // let next_month_day = new Date(nextMonthDate.replace(/-/g,"/"));
    var next_month_year = this.getYear(next_month_day);
    var next_month_month = this.getMonth(next_month_day);
    // console.log('下');

    // console.log(nextMonthDate);
    // console.log(next_month_day);
    // console.log(next_month_year+'年');
    // console.log(next_month_month+'月');


    var rl = []; //日历的结果
    var st = 0; //循环开始点
    var len = 7; //一星期七天
    var d = 1; //日期具体
    var next_d = 1; //下一个月的日期
    var pre_d = pre_month_count - start + 1; //上个月开始时间


    // let line = Math.ceil((count + start) / len); //日历的行数
    var line = 6; //日历的行数
    for (var i = 0; i < line; i++) {
      var y = [];
      for (var j = st; j < st + len; j++) {
        if (i == 0 && j < start) {
          var curr_day = new Date(pre_month_year, pre_month_month - 1, pre_d);
          var curr_t = {
            d: pre_d,
            full: this.dateFormat('yyyy-MM-dd', curr_day),
            show: this.dateFormat('M/dd', curr_day),
            num: this.dateFormat('dd', curr_day),
            has_activity: false,
            current: false
          };
          y.push(curr_t);
          pre_d++;
        } else if (j - start > count - 1) {
          var _curr_day = new Date(next_month_year, next_month_month - 1, next_d);
          var _curr_t = {
            d: next_d,
            full: this.dateFormat('yyyy-MM-dd', _curr_day),
            show: this.dateFormat('M/dd', _curr_day),
            num: this.dateFormat('dd', _curr_day),
            has_activity: false,
            current: false

          };
          y.push(_curr_t);
          next_d++;
        } else {
          var _curr_day2 = new Date(year, mon - 1, d);
          var _curr_t2 = {
            d: d,
            full: this.dateFormat('yyyy-MM-dd', _curr_day2),
            show: this.dateFormat('M/dd', _curr_day2),
            num: this.dateFormat('dd', _curr_day2),
            has_activity: false,
            current: true
          };
          y.push(_curr_t2);
          d++;
        }
      }
      st += len;
      rl.push(y);
    }
    return rl;
  },


  /**
   * 获取上一个月离结束的两天
   *
   * @date 格式为yyyy-mm-dd的日期，如：2014-01-25
   */
  getPreMonth: function getPreMonth(date) {
    var arr = date.split('-');
    var year = arr[0]; //获取当前日期的年份
    var month = arr[1]; //获取当前日期的月份
    var day = arr[2]; //获取当前日期的日
    var days = new Date(year, month, 0);
    days = days.getDate(); //获取当前日期中月的天数
    var year2 = year;
    var month2 = parseInt(month) - 1;
    if (month2 == 0) {
      year2 = parseInt(year2) - 1;
      month2 = 12;
    }
    var day2 = day;
    var days2 = new Date(year2, month2, 0);
    days2 = days2.getDate();
    if (day2 > days2) {
      day2 = days2;
    }
    if (month2 < 10) {
      month2 = '0' + month2;
    }
    var t2 = year2 + '-' + month2 + '-' + 1;
    return t2;
  },


  /**
   * 获取下一个月离结束的前两天
   *
   * @date 格式为yyyy-mm-dd的日期，如：2014-01-25
   */
  getNextMonth: function getNextMonth(date) {
    var arr = date.split('-');
    var year = arr[0]; //获取当前日期的年份
    var month = arr[1]; //获取当前日期的月份
    var day = arr[2]; //获取当前日期的日
    var days = new Date(year, month, 0);
    days = days.getDate(); //获取当前日期中的月的天数
    var year2 = year;
    var month2 = parseInt(month) + 1;
    if (month2 == 13) {
      year2 = parseInt(year2) + 1;
      month2 = 1;
    }
    var day2 = day;
    var days2 = new Date(year2, month2, 0);
    days2 = days2.getDate();
    if (day2 > days2) {
      day2 = days2;
    }
    if (month2 < 10) {
      month2 = '0' + month2;
    }
    var t2 = year2 + '-' + month2 + '-' + 1;
    return t2;
  },


  //获取一周的天数
  getOneMonth: function getOneMonth(date) {
    var curDate = new Date();
    /* 获取当前月份 */
    var curMonth = curDate.getMonth();
    /*  生成实际的月份: 由于curMonth会比实际月份小1, 故需加1 */
    curDate.setMonth(curMonth + 1);
    /* 将日期设置为0, 这里为什么要这样设置, 我不知道原因, 这是从网上学来的 */
    curDate.setDate(0);
    /* 返回当月的天数 */
    return curDate.getDate();
  },


  //一周时间的毫秒数
  getOneWeekTime: function getOneWeekTime() {
    return 7 * 24 * 60 * 60 * 1000;
  },
  getDateDiff: function getDateDiff(startDate, endDate) {
    var startTime = new Date(Date.parse(startDate.replace(/-/g, "/"))).getTime();
    var endTime = new Date(Date.parse(endDate.replace(/-/g, "/"))).getTime();
    var dates = Math.abs(startTime - endTime) / (1000 * 60 * 60 * 24);
    return dates;
  },


  //计算当前时间戳相对 其他时间时间戳小时分秒数
  countTimeLong: function countTimeLong(timestramp_start, timestramp_end, double) {
    var now = parseInt(new Date().getTime() / 1000);
    var end = timestramp_end ? timestramp_end : now;
    var long = end - timestramp_start;

    var hours = parseInt(long / (60 * 60));

    var mins = parseInt((long - hours * 60 * 60) / 60);
    var scen = long - hours * 60 * 60 - mins * 60;
    if (double) {
      if (hours < 10) {
        hours = '0' + hours;
      }
      if (mins < 10) {
        mins = '0' + mins;
      }
      if (scen < 10) {
        scen = '0' + scen;
      }
    }
    return {
      h: hours,
      m: mins,
      s: scen
    };
  }
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRhdGUuanMiXSwibmFtZXMiOlsiZGF0ZUZvcm1hdCIsImZtdCIsImRhdGUiLCJvIiwiZ2V0TW9udGgiLCJnZXREYXRlIiwiZ2V0SG91cnMiLCJnZXRNaW51dGVzIiwiZ2V0U2Vjb25kcyIsIk1hdGgiLCJmbG9vciIsImdldE1pbGxpc2Vjb25kcyIsInRlc3QiLCJyZXBsYWNlIiwiUmVnRXhwIiwiJDEiLCJnZXRGdWxsWWVhciIsInN1YnN0ciIsImxlbmd0aCIsImsiLCJnZXRXZWVrTGlzdCIsImRhdGVUaW1lIiwiZ2V0VGltZSIsImRhdGVEYXkiLCJnZXREYXkiLCJvbmVEYXlUaW1lIiwic3RhcnREYXRlVGltZSIsIndlZWtsaXN0IiwiaSIsInRpbWUiLCJEYXRlIiwiZ2V0Q291bnREYXlzIiwiY3VyRGF0ZSIsImN1ck1vbnRoIiwiY3VyWWVhciIsImdldFllYXIiLCJjb25zb2xlIiwibG9nIiwieWVhciIsIm1vbnRoIiwibm93ZGF0ZSIsInB1cl9kYXRlIiwiZ2V0V2VlayIsImdldE1vbnRoRXZlcnlEYXkiLCJwcnVfZGF0ZSIsIm1vbiIsInN0YXJ0IiwiY291bnQiLCJwcmVNb250aERhdGUiLCJnZXRQcmVNb250aCIsInByZV9tb250aF9jb3VudCIsInByZV9tb250aF9kYXkiLCJwcmVfbW9udGhfeWVhciIsInByZV9tb250aF9tb250aCIsIm5leHRNb250aERhdGUiLCJnZXROZXh0TW9udGgiLCJuZXh0X21vbnRoX2RheSIsIm5leHRfbW9udGhfeWVhciIsIm5leHRfbW9udGhfbW9udGgiLCJybCIsInN0IiwibGVuIiwiZCIsIm5leHRfZCIsInByZV9kIiwibGluZSIsInkiLCJqIiwiY3Vycl9kYXkiLCJjdXJyX3QiLCJmdWxsIiwic2hvdyIsIm51bSIsImhhc19hY3Rpdml0eSIsImN1cnJlbnQiLCJwdXNoIiwiYXJyIiwic3BsaXQiLCJkYXkiLCJkYXlzIiwieWVhcjIiLCJtb250aDIiLCJwYXJzZUludCIsImRheTIiLCJkYXlzMiIsInQyIiwiZ2V0T25lTW9udGgiLCJzZXRNb250aCIsInNldERhdGUiLCJnZXRPbmVXZWVrVGltZSIsImdldERhdGVEaWZmIiwic3RhcnREYXRlIiwiZW5kRGF0ZSIsInN0YXJ0VGltZSIsInBhcnNlIiwiZW5kVGltZSIsImRhdGVzIiwiYWJzIiwiY291bnRUaW1lTG9uZyIsInRpbWVzdHJhbXBfc3RhcnQiLCJ0aW1lc3RyYW1wX2VuZCIsImRvdWJsZSIsIm5vdyIsImVuZCIsImxvbmciLCJob3VycyIsIm1pbnMiLCJzY2VuIiwiaCIsIm0iLCJzIl0sIm1hcHBpbmdzIjoiOzs7OztrQkFBZTtBQUNiO0FBQ0FBLFlBRmEsc0JBRUZDLEdBRkUsRUFFR0MsSUFGSCxFQUVTO0FBQ3BCLFFBQUlDLElBQUk7QUFDTixZQUFNRCxLQUFLRSxRQUFMLEtBQWtCLENBRGxCLEVBQ3FCO0FBQzNCLFlBQU1GLEtBQUtHLE9BQUwsRUFGQSxFQUVnQjtBQUN0QixZQUFNSCxLQUFLSSxRQUFMLEVBSEEsRUFHaUI7QUFDdkIsWUFBTUosS0FBS0ssVUFBTCxFQUpBLEVBSW1CO0FBQ3pCLFlBQU1MLEtBQUtNLFVBQUwsRUFMQSxFQUttQjtBQUN6QixZQUFNQyxLQUFLQyxLQUFMLENBQVcsQ0FBQ1IsS0FBS0UsUUFBTCxLQUFrQixDQUFuQixJQUF3QixDQUFuQyxDQU5BLEVBTXVDO0FBQzdDLFdBQUtGLEtBQUtTLGVBQUwsRUFQQyxDQU9zQjtBQVB0QixLQUFSO0FBU0EsUUFBSSxPQUFPQyxJQUFQLENBQVlYLEdBQVosQ0FBSixFQUNFQSxNQUFNQSxJQUFJWSxPQUFKLENBQVlDLE9BQU9DLEVBQW5CLEVBQXVCLENBQUNiLEtBQUtjLFdBQUwsS0FBcUIsRUFBdEIsRUFBMEJDLE1BQTFCLENBQWlDLElBQUlILE9BQU9DLEVBQVAsQ0FBVUcsTUFBL0MsQ0FBdkIsQ0FBTjtBQUNGLFNBQUssSUFBSUMsQ0FBVCxJQUFjaEIsQ0FBZDtBQUNFLFVBQUksSUFBSVcsTUFBSixDQUFXLE1BQU1LLENBQU4sR0FBVSxHQUFyQixFQUEwQlAsSUFBMUIsQ0FBK0JYLEdBQS9CLENBQUosRUFDRUEsTUFBTUEsSUFBSVksT0FBSixDQUFZQyxPQUFPQyxFQUFuQixFQUF3QkQsT0FBT0MsRUFBUCxDQUFVRyxNQUFWLElBQW9CLENBQXJCLEdBQTJCZixFQUFFZ0IsQ0FBRixDQUEzQixHQUFvQyxDQUFDLE9BQU9oQixFQUFFZ0IsQ0FBRixDQUFSLEVBQWNGLE1BQWQsQ0FBcUIsQ0FBQyxLQUFLZCxFQUFFZ0IsQ0FBRixDQUFOLEVBQVlELE1BQWpDLENBQTNELENBQU47QUFGSixLQUdBLE9BQU9qQixHQUFQO0FBQ0QsR0FsQlk7OztBQW9CYjtBQUNBbUIsYUFyQmEsdUJBcUJEbkIsR0FyQkMsRUFxQklDLElBckJKLEVBcUJVO0FBQ3JCLFFBQUltQixXQUFXbkIsS0FBS29CLE9BQUwsRUFBZixDQURxQixDQUNVO0FBQy9CLFFBQUlDLFVBQVVyQixLQUFLc0IsTUFBTCxFQUFkLENBRnFCLENBRVE7QUFDN0IsUUFBSUMsYUFBYSxLQUFLLEVBQUwsR0FBVSxFQUFWLEdBQWUsSUFBaEMsQ0FIcUIsQ0FHaUI7QUFDdEMsUUFBSUMsZ0JBQWdCTCxXQUFXSSxhQUFhRixPQUE1QztBQUNBLFFBQUlJLFdBQVcsRUFBZjtBQUNBLFNBQUssSUFBSUMsSUFBSSxDQUFiLEVBQWdCQSxJQUFJLENBQXBCLEVBQXVCQSxHQUF2QixFQUE0QjtBQUMxQixVQUFJQyxPQUFPSCxnQkFBZ0JFLElBQUlILFVBQS9CO0FBQ0FFLGVBQVNDLENBQVQsSUFBYyxLQUFLNUIsVUFBTCxDQUFnQkMsR0FBaEIsRUFBcUIsSUFBSTZCLElBQUosQ0FBU0QsSUFBVCxDQUFyQixDQUFkO0FBQ0Q7QUFDRCxXQUFPRixRQUFQO0FBQ0QsR0FoQ1k7OztBQWtDYjs7Ozs7QUFLQUksY0F2Q2Esd0JBdUNBQyxPQXZDQSxFQXVDUztBQUNwQjtBQUNBLFFBQUlDLFdBQVcsS0FBSzdCLFFBQUwsQ0FBYzRCLE9BQWQsQ0FBZjtBQUNBLFFBQUlFLFVBQVUsS0FBS0MsT0FBTCxDQUFhSCxPQUFiLENBQWQ7QUFDQUksWUFBUUMsR0FBUixDQUFZLE9BQVo7QUFDQUQsWUFBUUMsR0FBUixDQUFZTCxPQUFaO0FBQ0FJLFlBQVFDLEdBQVIsQ0FBWUosUUFBWjtBQUNBRyxZQUFRQyxHQUFSLENBQVlILE9BQVo7QUFDQUUsWUFBUUMsR0FBUixDQUFZLElBQUlQLElBQUosQ0FBU0ksT0FBVCxFQUFpQkQsUUFBakIsRUFBMEIsQ0FBMUIsRUFBNkI1QixPQUE3QixFQUFaOztBQUVBLFdBQU8sSUFBSXlCLElBQUosQ0FBU0ksT0FBVCxFQUFpQkQsUUFBakIsRUFBMEIsQ0FBMUIsRUFBNkI1QixPQUE3QixFQUFQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0QsR0F4RFk7OztBQTREYjs7O0FBR0FBLFNBL0RhLG1CQStETGlDLElBL0RLLEVBK0RDQyxLQS9ERCxFQStEUTtBQUNuQixRQUFJQyxVQUFVLElBQUlWLElBQUosQ0FBVVEsSUFBVixFQUFpQkMsUUFBTSxDQUF2QixFQUF5QixDQUF6QixDQUFkO0FBQ0EsV0FBT0MsUUFBUWhCLE1BQVIsRUFBUDtBQUNELEdBbEVZOzs7QUFvRWI7OztBQUdBcEIsVUF2RWEsb0JBdUVKRixJQXZFSSxFQXVFRTtBQUNiLFFBQUl1QyxXQUFXdkMsT0FBT0EsSUFBUCxHQUFjLElBQUk0QixJQUFKLEVBQTdCO0FBQ0EsV0FBT1csU0FBU3JDLFFBQVQsS0FBc0IsQ0FBN0I7QUFDRCxHQTFFWTs7O0FBNEViOzs7OztBQUtBK0IsU0FqRmEsbUJBaUZMakMsSUFqRkssRUFpRkM7QUFDWixRQUFJdUMsV0FBV3ZDLE9BQU9BLElBQVAsR0FBYyxJQUFJNEIsSUFBSixFQUE3QjtBQUNBLFdBQU9XLFNBQVN6QixXQUFULEVBQVA7QUFDRCxHQXBGWTtBQXNGYjBCLFNBdEZhLG1CQXNGTHhDLElBdEZLLEVBc0ZDO0FBQ1osUUFBSXVDLFdBQVd2QyxPQUFPQSxJQUFQLEdBQWMsSUFBSTRCLElBQUosRUFBN0I7QUFDQSxXQUFPVyxTQUFTakIsTUFBVCxFQUFQO0FBQ0QsR0F6Rlk7OztBQTRGYjtBQUNBbUIsa0JBN0ZhLDRCQTZGSXpDLElBN0ZKLEVBNkZVO0FBQ3JCLFFBQUkwQyxXQUFXMUMsT0FBT0EsSUFBUCxHQUFjLElBQUk0QixJQUFKLEVBQTdCO0FBQ0E7QUFDQTtBQUNBLFFBQUllLE1BQU0sS0FBS3pDLFFBQUwsQ0FBY3dDLFFBQWQsQ0FBVjtBQUNBLFFBQUlOLE9BQU8sS0FBS0gsT0FBTCxDQUFhUyxRQUFiLENBQVg7QUFDQSxRQUFJRSxRQUFRLEtBQUt6QyxPQUFMLENBQWFpQyxJQUFiLEVBQW1CTyxHQUFuQixDQUFaLENBTnFCLENBTWdCO0FBQ3JDLFFBQUlFLFFBQVEsS0FBS2hCLFlBQUwsQ0FBa0JhLFFBQWxCLENBQVosQ0FQcUIsQ0FPb0I7QUFDekNSLFlBQVFDLEdBQVIsQ0FBWU8sUUFBWjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLFFBQUlJLGVBQWUsS0FBS0MsV0FBTCxDQUFpQixLQUFLakQsVUFBTCxDQUFnQixZQUFoQixFQUE4QjRDLFFBQTlCLENBQWpCLENBQW5CLENBZHFCLENBY3lEO0FBQzlFUixZQUFRQyxHQUFSLENBQVlXLFlBQVo7O0FBRUEsUUFBSUUsa0JBQWtCLEtBQUtuQixZQUFMLENBQWtCLElBQUlELElBQUosQ0FBU2tCLGFBQWFuQyxPQUFiLENBQXFCLElBQXJCLEVBQTBCLEdBQTFCLENBQVQsQ0FBbEIsQ0FBdEIsQ0FqQnFCLENBaUI4RDtBQUNuRixRQUFJc0MsZ0JBQWdCLElBQUlyQixJQUFKLENBQVNrQixhQUFhbkMsT0FBYixDQUFxQixJQUFyQixFQUEwQixHQUExQixDQUFULENBQXBCO0FBQ0EsUUFBSXVDLGlCQUFpQixLQUFLakIsT0FBTCxDQUFhZ0IsYUFBYixDQUFyQjtBQUNBLFFBQUlFLGtCQUFrQixLQUFLakQsUUFBTCxDQUFjK0MsYUFBZCxDQUF0QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxRQUFJRyxnQkFBZ0IsS0FBS0MsWUFBTCxDQUFrQixLQUFLdkQsVUFBTCxDQUFnQixZQUFoQixFQUE4QjRDLFFBQTlCLENBQWxCLENBQXBCO0FBQ0FSLFlBQVFDLEdBQVIsQ0FBWWlCLGFBQVo7QUFDQSxRQUFJRSxpQkFBaUIsSUFBSTFCLElBQUosQ0FBU3dCLGNBQWN6QyxPQUFkLENBQXNCLElBQXRCLEVBQTJCLEdBQTNCLENBQVQsQ0FBckI7QUFDQTtBQUNBLFFBQUk0QyxrQkFBa0IsS0FBS3RCLE9BQUwsQ0FBYXFCLGNBQWIsQ0FBdEI7QUFDQSxRQUFJRSxtQkFBbUIsS0FBS3RELFFBQUwsQ0FBY29ELGNBQWQsQ0FBdkI7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0EsUUFBSUcsS0FBSyxFQUFULENBMUNxQixDQTBDUjtBQUNiLFFBQUlDLEtBQUssQ0FBVCxDQTNDcUIsQ0EyQ1Q7QUFDWixRQUFJQyxNQUFNLENBQVYsQ0E1Q3FCLENBNENSO0FBQ2IsUUFBSUMsSUFBSSxDQUFSLENBN0NxQixDQTZDVjtBQUNYLFFBQUlDLFNBQVMsQ0FBYixDQTlDcUIsQ0E4Q0w7QUFDaEIsUUFBSUMsUUFBUWQsa0JBQWtCSixLQUFsQixHQUEwQixDQUF0QyxDQS9DcUIsQ0ErQ29COzs7QUFHekM7QUFDQSxRQUFJbUIsT0FBTyxDQUFYLENBbkRxQixDQW1EUDtBQUNkLFNBQUssSUFBSXJDLElBQUksQ0FBYixFQUFnQkEsSUFBSXFDLElBQXBCLEVBQTBCckMsR0FBMUIsRUFBK0I7QUFDN0IsVUFBSXNDLElBQUksRUFBUjtBQUNBLFdBQUssSUFBSUMsSUFBSVAsRUFBYixFQUFpQk8sSUFBSVAsS0FBS0MsR0FBMUIsRUFBK0JNLEdBQS9CLEVBQW9DO0FBQ2xDLFlBQUt2QyxLQUFLLENBQUwsSUFBVXVDLElBQUlyQixLQUFuQixFQUEyQjtBQUN6QixjQUFJc0IsV0FBVyxJQUFJdEMsSUFBSixDQUFTc0IsY0FBVCxFQUF5QkMsa0JBQWtCLENBQTNDLEVBQThDVyxLQUE5QyxDQUFmO0FBQ0EsY0FBSUssU0FBUztBQUNYUCxlQUFHRSxLQURRO0FBRVhNLGtCQUFNLEtBQUt0RSxVQUFMLENBQWdCLFlBQWhCLEVBQThCb0UsUUFBOUIsQ0FGSztBQUdYRyxrQkFBTSxLQUFLdkUsVUFBTCxDQUFnQixNQUFoQixFQUF3Qm9FLFFBQXhCLENBSEs7QUFJWEksaUJBQUssS0FBS3hFLFVBQUwsQ0FBZ0IsSUFBaEIsRUFBc0JvRSxRQUF0QixDQUpNO0FBS1hLLDBCQUFjLEtBTEg7QUFNWEMscUJBQVM7QUFORSxXQUFiO0FBUUFSLFlBQUVTLElBQUYsQ0FBT04sTUFBUDtBQUNBTDtBQUNELFNBWkQsTUFZTyxJQUFLRyxJQUFJckIsS0FBTCxHQUFjQyxRQUFRLENBQTFCLEVBQTZCO0FBQ2xDLGNBQUlxQixZQUFXLElBQUl0QyxJQUFKLENBQVMyQixlQUFULEVBQTBCQyxtQkFBbUIsQ0FBN0MsRUFBZ0RLLE1BQWhELENBQWY7QUFDQSxjQUFJTSxVQUFTO0FBQ1hQLGVBQUdDLE1BRFE7QUFFWE8sa0JBQU0sS0FBS3RFLFVBQUwsQ0FBZ0IsWUFBaEIsRUFBOEJvRSxTQUE5QixDQUZLO0FBR1hHLGtCQUFNLEtBQUt2RSxVQUFMLENBQWdCLE1BQWhCLEVBQXdCb0UsU0FBeEIsQ0FISztBQUlYSSxpQkFBSyxLQUFLeEUsVUFBTCxDQUFnQixJQUFoQixFQUFzQm9FLFNBQXRCLENBSk07QUFLWEssMEJBQWMsS0FMSDtBQU1YQyxxQkFBUzs7QUFORSxXQUFiO0FBU0FSLFlBQUVTLElBQUYsQ0FBT04sT0FBUDtBQUNBTjtBQUNELFNBYk0sTUFhQTtBQUNMLGNBQUlLLGFBQVcsSUFBSXRDLElBQUosQ0FBU1EsSUFBVCxFQUFlTyxNQUFNLENBQXJCLEVBQXdCaUIsQ0FBeEIsQ0FBZjtBQUNBLGNBQUlPLFdBQVM7QUFDWFAsZUFBR0EsQ0FEUTtBQUVYUSxrQkFBTSxLQUFLdEUsVUFBTCxDQUFnQixZQUFoQixFQUE4Qm9FLFVBQTlCLENBRks7QUFHWEcsa0JBQU0sS0FBS3ZFLFVBQUwsQ0FBZ0IsTUFBaEIsRUFBd0JvRSxVQUF4QixDQUhLO0FBSVhJLGlCQUFLLEtBQUt4RSxVQUFMLENBQWdCLElBQWhCLEVBQXNCb0UsVUFBdEIsQ0FKTTtBQUtYSywwQkFBYyxLQUxIO0FBTVhDLHFCQUFTO0FBTkUsV0FBYjtBQVFBUixZQUFFUyxJQUFGLENBQU9OLFFBQVA7QUFDQVA7QUFDRDtBQUNGO0FBQ0RGLFlBQU1DLEdBQU47QUFDQUYsU0FBR2dCLElBQUgsQ0FBUVQsQ0FBUjtBQUNEO0FBQ0QsV0FBT1AsRUFBUDtBQUNELEdBL0xZOzs7QUFpTWI7Ozs7O0FBS0FWLGFBdE1hLHVCQXNNRC9DLElBdE1DLEVBc01LO0FBQ2hCLFFBQUkwRSxNQUFNMUUsS0FBSzJFLEtBQUwsQ0FBVyxHQUFYLENBQVY7QUFDQSxRQUFJdkMsT0FBT3NDLElBQUksQ0FBSixDQUFYLENBRmdCLENBRUc7QUFDbkIsUUFBSXJDLFFBQVFxQyxJQUFJLENBQUosQ0FBWixDQUhnQixDQUdJO0FBQ3BCLFFBQUlFLE1BQU1GLElBQUksQ0FBSixDQUFWLENBSmdCLENBSUU7QUFDbEIsUUFBSUcsT0FBTyxJQUFJakQsSUFBSixDQUFTUSxJQUFULEVBQWVDLEtBQWYsRUFBc0IsQ0FBdEIsQ0FBWDtBQUNBd0MsV0FBT0EsS0FBSzFFLE9BQUwsRUFBUCxDQU5nQixDQU1PO0FBQ3ZCLFFBQUkyRSxRQUFRMUMsSUFBWjtBQUNBLFFBQUkyQyxTQUFTQyxTQUFTM0MsS0FBVCxJQUFrQixDQUEvQjtBQUNBLFFBQUkwQyxVQUFVLENBQWQsRUFBaUI7QUFDZkQsY0FBUUUsU0FBU0YsS0FBVCxJQUFrQixDQUExQjtBQUNBQyxlQUFTLEVBQVQ7QUFDRDtBQUNELFFBQUlFLE9BQU9MLEdBQVg7QUFDQSxRQUFJTSxRQUFRLElBQUl0RCxJQUFKLENBQVNrRCxLQUFULEVBQWdCQyxNQUFoQixFQUF3QixDQUF4QixDQUFaO0FBQ0FHLFlBQVFBLE1BQU0vRSxPQUFOLEVBQVI7QUFDQSxRQUFJOEUsT0FBT0MsS0FBWCxFQUFrQjtBQUNoQkQsYUFBT0MsS0FBUDtBQUNEO0FBQ0QsUUFBSUgsU0FBUyxFQUFiLEVBQWlCO0FBQ2ZBLGVBQVMsTUFBTUEsTUFBZjtBQUNEO0FBQ0QsUUFBSUksS0FBS0wsUUFBUSxHQUFSLEdBQWNDLE1BQWQsR0FBdUIsR0FBdkIsR0FBNkIsQ0FBdEM7QUFDQSxXQUFPSSxFQUFQO0FBQ0QsR0E5Tlk7OztBQWdPYjs7Ozs7QUFLQTlCLGNBck9hLHdCQXFPQXJELElBck9BLEVBcU9NO0FBQ2pCLFFBQUkwRSxNQUFNMUUsS0FBSzJFLEtBQUwsQ0FBVyxHQUFYLENBQVY7QUFDQSxRQUFJdkMsT0FBT3NDLElBQUksQ0FBSixDQUFYLENBRmlCLENBRUU7QUFDbkIsUUFBSXJDLFFBQVFxQyxJQUFJLENBQUosQ0FBWixDQUhpQixDQUdHO0FBQ3BCLFFBQUlFLE1BQU1GLElBQUksQ0FBSixDQUFWLENBSmlCLENBSUM7QUFDbEIsUUFBSUcsT0FBTyxJQUFJakQsSUFBSixDQUFTUSxJQUFULEVBQWVDLEtBQWYsRUFBc0IsQ0FBdEIsQ0FBWDtBQUNBd0MsV0FBT0EsS0FBSzFFLE9BQUwsRUFBUCxDQU5pQixDQU1NO0FBQ3ZCLFFBQUkyRSxRQUFRMUMsSUFBWjtBQUNBLFFBQUkyQyxTQUFTQyxTQUFTM0MsS0FBVCxJQUFrQixDQUEvQjtBQUNBLFFBQUkwQyxVQUFVLEVBQWQsRUFBa0I7QUFDaEJELGNBQVFFLFNBQVNGLEtBQVQsSUFBa0IsQ0FBMUI7QUFDQUMsZUFBUyxDQUFUO0FBQ0Q7QUFDRCxRQUFJRSxPQUFPTCxHQUFYO0FBQ0EsUUFBSU0sUUFBUSxJQUFJdEQsSUFBSixDQUFTa0QsS0FBVCxFQUFnQkMsTUFBaEIsRUFBd0IsQ0FBeEIsQ0FBWjtBQUNBRyxZQUFRQSxNQUFNL0UsT0FBTixFQUFSO0FBQ0EsUUFBSThFLE9BQU9DLEtBQVgsRUFBa0I7QUFDaEJELGFBQU9DLEtBQVA7QUFDRDtBQUNELFFBQUlILFNBQVMsRUFBYixFQUFpQjtBQUNmQSxlQUFTLE1BQU1BLE1BQWY7QUFDRDtBQUNELFFBQUlJLEtBQUtMLFFBQVEsR0FBUixHQUFjQyxNQUFkLEdBQXVCLEdBQXZCLEdBQTZCLENBQXRDO0FBQ0EsV0FBT0ksRUFBUDtBQUNELEdBN1BZOzs7QUFnUWI7QUFDQUMsYUFqUWEsdUJBaVFEcEYsSUFqUUMsRUFpUUs7QUFDaEIsUUFBSThCLFVBQVUsSUFBSUYsSUFBSixFQUFkO0FBQ0E7QUFDQSxRQUFJRyxXQUFXRCxRQUFRNUIsUUFBUixFQUFmO0FBQ0E7QUFDQTRCLFlBQVF1RCxRQUFSLENBQWlCdEQsV0FBVyxDQUE1QjtBQUNBO0FBQ0FELFlBQVF3RCxPQUFSLENBQWdCLENBQWhCO0FBQ0E7QUFDQSxXQUFPeEQsUUFBUTNCLE9BQVIsRUFBUDtBQUNELEdBM1FZOzs7QUE2UWI7QUFDQW9GLGdCQTlRYSw0QkE4UUk7QUFDZixXQUFPLElBQUksRUFBSixHQUFTLEVBQVQsR0FBYyxFQUFkLEdBQW1CLElBQTFCO0FBQ0QsR0FoUlk7QUFrUmJDLGFBbFJhLHVCQWtSREMsU0FsUkMsRUFrUlVDLE9BbFJWLEVBa1JtQjtBQUM5QixRQUFJQyxZQUFZLElBQUkvRCxJQUFKLENBQVNBLEtBQUtnRSxLQUFMLENBQVdILFVBQVU5RSxPQUFWLENBQWtCLElBQWxCLEVBQXdCLEdBQXhCLENBQVgsQ0FBVCxFQUFtRFMsT0FBbkQsRUFBaEI7QUFDQSxRQUFJeUUsVUFBVSxJQUFJakUsSUFBSixDQUFTQSxLQUFLZ0UsS0FBTCxDQUFXRixRQUFRL0UsT0FBUixDQUFnQixJQUFoQixFQUFzQixHQUF0QixDQUFYLENBQVQsRUFBaURTLE9BQWpELEVBQWQ7QUFDQSxRQUFJMEUsUUFBUXZGLEtBQUt3RixHQUFMLENBQVVKLFlBQVlFLE9BQXRCLEtBQW1DLE9BQU8sRUFBUCxHQUFZLEVBQVosR0FBaUIsRUFBcEQsQ0FBWjtBQUNBLFdBQU9DLEtBQVA7QUFDRCxHQXZSWTs7O0FBeVJiO0FBQ0FFLGVBMVJhLHlCQTBSQ0MsZ0JBMVJELEVBMFJtQkMsY0ExUm5CLEVBMFJtQ0MsTUExUm5DLEVBMFIyQztBQUN0RCxRQUFJQyxNQUFNcEIsU0FBUyxJQUFJcEQsSUFBSixHQUFXUixPQUFYLEtBQXVCLElBQWhDLENBQVY7QUFDQSxRQUFJaUYsTUFBTUgsaUJBQWlCQSxjQUFqQixHQUFrQ0UsR0FBNUM7QUFDQSxRQUFJRSxPQUFPRCxNQUFNSixnQkFBakI7O0FBRUEsUUFBSU0sUUFBUXZCLFNBQVNzQixRQUFRLEtBQUssRUFBYixDQUFULENBQVo7O0FBRUEsUUFBSUUsT0FBT3hCLFNBQVMsQ0FBQ3NCLE9BQU9DLFFBQVEsRUFBUixHQUFhLEVBQXJCLElBQTJCLEVBQXBDLENBQVg7QUFDQSxRQUFJRSxPQUFPSCxPQUFPQyxRQUFRLEVBQVIsR0FBYSxFQUFwQixHQUF5QkMsT0FBTyxFQUEzQztBQUNBLFFBQUlMLE1BQUosRUFBWTtBQUNWLFVBQUlJLFFBQVEsRUFBWixFQUFnQjtBQUNkQSxnQkFBUSxNQUFNQSxLQUFkO0FBQ0Q7QUFDRCxVQUFJQyxPQUFPLEVBQVgsRUFBZTtBQUNiQSxlQUFPLE1BQU1BLElBQWI7QUFDRDtBQUNELFVBQUlDLE9BQU8sRUFBWCxFQUFlO0FBQ2JBLGVBQU8sTUFBTUEsSUFBYjtBQUNEO0FBQ0Y7QUFDRCxXQUFPO0FBQ0xDLFNBQUdILEtBREU7QUFFTEksU0FBR0gsSUFGRTtBQUdMSSxTQUFHSDtBQUhFLEtBQVA7QUFLRDtBQW5UWSxDIiwiZmlsZSI6ImRhdGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgZGVmYXVsdCB7XG4gIC8v5qC85byP5YyW5pel5pyfIFwieXl5eS1NTS1kZCBoaDptbTpzc1wiXG4gIGRhdGVGb3JtYXQoZm10LCBkYXRlKSB7XG4gICAgdmFyIG8gPSB7XG4gICAgICBcIk0rXCI6IGRhdGUuZ2V0TW9udGgoKSArIDEsIC8v5pyI5Lu9ICAgXG4gICAgICBcImQrXCI6IGRhdGUuZ2V0RGF0ZSgpLCAvL+aXpSAgIFxuICAgICAgXCJoK1wiOiBkYXRlLmdldEhvdXJzKCksIC8v5bCP5pe2ICAgXG4gICAgICBcIm0rXCI6IGRhdGUuZ2V0TWludXRlcygpLCAvL+WIhiAgIFxuICAgICAgXCJzK1wiOiBkYXRlLmdldFNlY29uZHMoKSwgLy/np5IgICBcbiAgICAgIFwicStcIjogTWF0aC5mbG9vcigoZGF0ZS5nZXRNb250aCgpICsgMykgLyAzKSwgLy/lraPluqYgICBcbiAgICAgIFwiU1wiOiBkYXRlLmdldE1pbGxpc2Vjb25kcygpIC8v5q+r56eSICAgXG4gICAgfTtcbiAgICBpZiAoLyh5KykvLnRlc3QoZm10KSlcbiAgICAgIGZtdCA9IGZtdC5yZXBsYWNlKFJlZ0V4cC4kMSwgKGRhdGUuZ2V0RnVsbFllYXIoKSArIFwiXCIpLnN1YnN0cig0IC0gUmVnRXhwLiQxLmxlbmd0aCkpO1xuICAgIGZvciAodmFyIGsgaW4gbylcbiAgICAgIGlmIChuZXcgUmVnRXhwKFwiKFwiICsgayArIFwiKVwiKS50ZXN0KGZtdCkpXG4gICAgICAgIGZtdCA9IGZtdC5yZXBsYWNlKFJlZ0V4cC4kMSwgKFJlZ0V4cC4kMS5sZW5ndGggPT0gMSkgPyAob1trXSkgOiAoKFwiMDBcIiArIG9ba10pLnN1YnN0cigoXCJcIiArIG9ba10pLmxlbmd0aCkpKTtcbiAgICByZXR1cm4gZm10O1xuICB9LFxuXG4gIC8v6I635Y+W5LiA5ZGo55qE5pe26Ze0XG4gIGdldFdlZWtMaXN0KGZtdCwgZGF0ZSkge1xuICAgIHZhciBkYXRlVGltZSA9IGRhdGUuZ2V0VGltZSgpOyAvLyDojrflj5bnjrDlnKjnmoTml7bpl7RcbiAgICB2YXIgZGF0ZURheSA9IGRhdGUuZ2V0RGF5KCk7IC8v5pif5pyfXG4gICAgdmFyIG9uZURheVRpbWUgPSAyNCAqIDYwICogNjAgKiAxMDAwOyAvL+S4gOWkqeeahOaXtumXtFxuICAgIHZhciBzdGFydERhdGVUaW1lID0gZGF0ZVRpbWUgLSBvbmVEYXlUaW1lICogZGF0ZURheTtcbiAgICB2YXIgd2Vla2xpc3QgPSBbXTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IDc7IGkrKykge1xuICAgICAgdmFyIHRpbWUgPSBzdGFydERhdGVUaW1lICsgaSAqIG9uZURheVRpbWU7XG4gICAgICB3ZWVrbGlzdFtpXSA9IHRoaXMuZGF0ZUZvcm1hdChmbXQsIG5ldyBEYXRlKHRpbWUpKTtcbiAgICB9XG4gICAgcmV0dXJuIHdlZWtsaXN0O1xuICB9LFxuXG4gIC8qKlxuICAgKiBcbiAgICog6I635Y+W5LiA5Liq5pyI55qE5aSp5pWwXG4gICAqL1xuXG4gIGdldENvdW50RGF5cyhjdXJEYXRlKSB7XG4gICAgLyog6I635Y+W5b2T5YmN5pyI5Lu9ICovXG4gICAgdmFyIGN1ck1vbnRoID0gdGhpcy5nZXRNb250aChjdXJEYXRlKTtcbiAgICB2YXIgY3VyWWVhciA9IHRoaXMuZ2V0WWVhcihjdXJEYXRlKTtcbiAgICBjb25zb2xlLmxvZygnJiYmJiYnKTtcbiAgICBjb25zb2xlLmxvZyhjdXJEYXRlKTtcbiAgICBjb25zb2xlLmxvZyhjdXJNb250aCk7XG4gICAgY29uc29sZS5sb2coY3VyWWVhcik7XG4gICAgY29uc29sZS5sb2cobmV3IERhdGUoY3VyWWVhcixjdXJNb250aCwwKS5nZXREYXRlKCkpO1xuXG4gICAgcmV0dXJuIG5ldyBEYXRlKGN1clllYXIsY3VyTW9udGgsMCkuZ2V0RGF0ZSgpO1xuICAgIC8qIMKg55Sf5oiQ5a6e6ZmF55qE5pyI5Lu9OiDnlLHkuo5jdXJNb250aOS8muavlOWunumZheaciOS7veWwjzEsIOaVhemcgOWKoDEgKi9cbiAgICAvLyBjdXJEYXRlLnNldE1vbnRoKGN1ck1vbnRoICsgMSk7XG4gICAgLyog5bCG5pel5pyf6K6+572u5Li6MCwg6L+Z6YeM5Li65LuA5LmI6KaB6L+Z5qC36K6+572uLCDmiJHkuI3nn6XpgZPljp/lm6AsIOi/meaYr+S7jue9keS4iuWtpuadpeeahCAqL1xuICAgIC8vIGN1ckRhdGUuc2V0RGF0ZSgwKTtcbiAgICAvKiDov5Tlm57lvZPmnIjnmoTlpKnmlbAgKi9cbiAgICAvLyByZXR1cm4gY3VyRGF0ZS5nZXREYXRlKCk7XG4gIH0sXG5cblxuXG4gIC8qKlxuICAgKiDojrflj5bmn5DmnIjnrKzkuIDlpKnmmK/lkajlh6BcbiAgICovXG4gIGdldERhdGUoeWVhciwgbW9udGgpIHtcbiAgICBsZXQgbm93ZGF0ZSA9IG5ldyBEYXRlKCB5ZWFyICwgbW9udGgtMSwxKTtcbiAgICByZXR1cm4gbm93ZGF0ZS5nZXREYXkoKTtcbiAgfSxcblxuICAvKlxuICAgKuiOt+WPluaciOS7vVxuICAgKi9cbiAgZ2V0TW9udGgoZGF0ZSkge1xuICAgIGxldCBwdXJfZGF0ZSA9IGRhdGUgPyBkYXRlIDogbmV3IERhdGUoKTtcbiAgICByZXR1cm4gcHVyX2RhdGUuZ2V0TW9udGgoKSArIDE7XG4gIH0sXG5cbiAgLyoqXG4gICAqIFxuICAgKiDojrflj5blubTku71cbiAgICovXG5cbiAgZ2V0WWVhcihkYXRlKSB7XG4gICAgbGV0IHB1cl9kYXRlID0gZGF0ZSA/IGRhdGUgOiBuZXcgRGF0ZSgpO1xuICAgIHJldHVybiBwdXJfZGF0ZS5nZXRGdWxsWWVhcigpXG4gIH0sXG5cbiAgZ2V0V2VlayhkYXRlKSB7XG4gICAgbGV0IHB1cl9kYXRlID0gZGF0ZSA/IGRhdGUgOiBuZXcgRGF0ZSgpO1xuICAgIHJldHVybiBwdXJfZGF0ZS5nZXREYXkoKVxuICB9LFxuXG5cbiAgLy/pgJrov4fml7bpl7Tngrnojrflj5bor6XmnIjnmoTmr4/lpKlcbiAgZ2V0TW9udGhFdmVyeURheShkYXRlKSB7XG4gICAgbGV0IHBydV9kYXRlID0gZGF0ZSA/IGRhdGUgOiBuZXcgRGF0ZSgpO1xuICAgIC8vIGNvbnNvbGUubG9nKCflvZPliY3mnIjml6XmnJ/vvJonKTtcbiAgICAvLyBjb25zb2xlLmxvZyhwcnVfZGF0ZSk7XG4gICAgbGV0IG1vbiA9IHRoaXMuZ2V0TW9udGgocHJ1X2RhdGUpO1xuICAgIGxldCB5ZWFyID0gdGhpcy5nZXRZZWFyKHBydV9kYXRlKTtcbiAgICBsZXQgc3RhcnQgPSB0aGlzLmdldERhdGUoeWVhciwgbW9uKTsgLy/nrKzkuIDlpKnnmoTmmJ/mnJ9cbiAgICBsZXQgY291bnQgPSB0aGlzLmdldENvdW50RGF5cyhwcnVfZGF0ZSk7IC8v5b2T5pyI5oC75pWwXG4gICAgY29uc29sZS5sb2cocHJ1X2RhdGUpO1xuICAgIC8vIGNvbnNvbGUubG9nKG1vbik7XG4gICAgLy8gY29uc29sZS5sb2coeWVhcik7XG4gICAgLy8gY29uc29sZS5sb2coc3RhcnQpO1xuICAgIC8vIGNvbnNvbGUubG9nKGNvdW50KTtcblxuICAgIGxldCBwcmVNb250aERhdGUgPSB0aGlzLmdldFByZU1vbnRoKHRoaXMuZGF0ZUZvcm1hdCgneXl5eS1NTS1kZCcsIHBydV9kYXRlKSk7IC8v5LiK5LiA5Liq5pyI55qE5pyA5ZCO5LiA5aSpXG4gICAgY29uc29sZS5sb2cocHJlTW9udGhEYXRlKTtcblxuICAgIGxldCBwcmVfbW9udGhfY291bnQgPSB0aGlzLmdldENvdW50RGF5cyhuZXcgRGF0ZShwcmVNb250aERhdGUucmVwbGFjZSgvLS9nLFwiL1wiKSkpOyAvL+S4iuS4quaciOeahOWkqeaVsFxuICAgIGxldCBwcmVfbW9udGhfZGF5ID0gbmV3IERhdGUocHJlTW9udGhEYXRlLnJlcGxhY2UoLy0vZyxcIi9cIikpO1xuICAgIGxldCBwcmVfbW9udGhfeWVhciA9IHRoaXMuZ2V0WWVhcihwcmVfbW9udGhfZGF5KTtcbiAgICBsZXQgcHJlX21vbnRoX21vbnRoID0gdGhpcy5nZXRNb250aChwcmVfbW9udGhfZGF5KTtcbiAgICAvLyBjb25zb2xlLmxvZygn5LiKJyk7XG4gICAgLy8gY29uc29sZS5sb2cocHJlTW9udGhEYXRlKTtcbiAgICAvLyBjb25zb2xlLmxvZyhwcmVfbW9udGhfY291bnQpO1xuICAgIC8vIGNvbnNvbGUubG9nKHByZV9tb250aF9kYXkpO1xuICAgIC8vIGNvbnNvbGUubG9nKHByZV9tb250aF95ZWFyKyflubQnKTtcbiAgICAvLyBjb25zb2xlLmxvZyhwcmVfbW9udGhfbW9udGgrJ+aciCcpO1xuXG4gICAgbGV0IG5leHRNb250aERhdGUgPSB0aGlzLmdldE5leHRNb250aCh0aGlzLmRhdGVGb3JtYXQoJ3l5eXktTU0tZGQnLCBwcnVfZGF0ZSkpO1xuICAgIGNvbnNvbGUubG9nKG5leHRNb250aERhdGUpO1xuICAgIGxldCBuZXh0X21vbnRoX2RheSA9IG5ldyBEYXRlKG5leHRNb250aERhdGUucmVwbGFjZSgvLS9nLFwiL1wiKSk7XG4gICAgLy8gbGV0IG5leHRfbW9udGhfZGF5ID0gbmV3IERhdGUobmV4dE1vbnRoRGF0ZS5yZXBsYWNlKC8tL2csXCIvXCIpKTtcbiAgICBsZXQgbmV4dF9tb250aF95ZWFyID0gdGhpcy5nZXRZZWFyKG5leHRfbW9udGhfZGF5KTtcbiAgICBsZXQgbmV4dF9tb250aF9tb250aCA9IHRoaXMuZ2V0TW9udGgobmV4dF9tb250aF9kYXkpO1xuICAgIC8vIGNvbnNvbGUubG9nKCfkuIsnKTtcblxuICAgIC8vIGNvbnNvbGUubG9nKG5leHRNb250aERhdGUpO1xuICAgIC8vIGNvbnNvbGUubG9nKG5leHRfbW9udGhfZGF5KTtcbiAgICAvLyBjb25zb2xlLmxvZyhuZXh0X21vbnRoX3llYXIrJ+W5tCcpO1xuICAgIC8vIGNvbnNvbGUubG9nKG5leHRfbW9udGhfbW9udGgrJ+aciCcpO1xuXG5cbiAgICBsZXQgcmwgPSBbXTsgLy/ml6XljobnmoTnu5PmnpxcbiAgICBsZXQgc3QgPSAwOyAvL+W+queOr+W8gOWni+eCuVxuICAgIGxldCBsZW4gPSA3OyAvL+S4gOaYn+acn+S4g+WkqVxuICAgIGxldCBkID0gMTsgLy/ml6XmnJ/lhbfkvZNcbiAgICBsZXQgbmV4dF9kID0gMTsgLy/kuIvkuIDkuKrmnIjnmoTml6XmnJ9cbiAgICBsZXQgcHJlX2QgPSBwcmVfbW9udGhfY291bnQgLSBzdGFydCArIDE7IC8v5LiK5Liq5pyI5byA5aeL5pe26Ze0XG5cblxuICAgIC8vIGxldCBsaW5lID0gTWF0aC5jZWlsKChjb3VudCArIHN0YXJ0KSAvIGxlbik7IC8v5pel5Y6G55qE6KGM5pWwXG4gICAgbGV0IGxpbmUgPSA2OyAvL+aXpeWOhueahOihjOaVsFxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGluZTsgaSsrKSB7XG4gICAgICBsZXQgeSA9IFtdO1xuICAgICAgZm9yIChsZXQgaiA9IHN0OyBqIDwgc3QgKyBsZW47IGorKykge1xuICAgICAgICBpZiAoKGkgPT0gMCAmJiBqIDwgc3RhcnQpKSB7XG4gICAgICAgICAgbGV0IGN1cnJfZGF5ID0gbmV3IERhdGUocHJlX21vbnRoX3llYXIsIHByZV9tb250aF9tb250aCAtIDEsIHByZV9kKTtcbiAgICAgICAgICBsZXQgY3Vycl90ID0ge1xuICAgICAgICAgICAgZDogcHJlX2QsXG4gICAgICAgICAgICBmdWxsOiB0aGlzLmRhdGVGb3JtYXQoJ3l5eXktTU0tZGQnLCBjdXJyX2RheSksXG4gICAgICAgICAgICBzaG93OiB0aGlzLmRhdGVGb3JtYXQoJ00vZGQnLCBjdXJyX2RheSksXG4gICAgICAgICAgICBudW06IHRoaXMuZGF0ZUZvcm1hdCgnZGQnLCBjdXJyX2RheSksXG4gICAgICAgICAgICBoYXNfYWN0aXZpdHk6IGZhbHNlLFxuICAgICAgICAgICAgY3VycmVudDogZmFsc2VcbiAgICAgICAgICB9XG4gICAgICAgICAgeS5wdXNoKGN1cnJfdCk7XG4gICAgICAgICAgcHJlX2QrKztcbiAgICAgICAgfSBlbHNlIGlmICgoaiAtIHN0YXJ0KSA+IGNvdW50IC0gMSkge1xuICAgICAgICAgIGxldCBjdXJyX2RheSA9IG5ldyBEYXRlKG5leHRfbW9udGhfeWVhciwgbmV4dF9tb250aF9tb250aCAtIDEsIG5leHRfZCk7XG4gICAgICAgICAgbGV0IGN1cnJfdCA9IHtcbiAgICAgICAgICAgIGQ6IG5leHRfZCxcbiAgICAgICAgICAgIGZ1bGw6IHRoaXMuZGF0ZUZvcm1hdCgneXl5eS1NTS1kZCcsIGN1cnJfZGF5KSxcbiAgICAgICAgICAgIHNob3c6IHRoaXMuZGF0ZUZvcm1hdCgnTS9kZCcsIGN1cnJfZGF5KSxcbiAgICAgICAgICAgIG51bTogdGhpcy5kYXRlRm9ybWF0KCdkZCcsIGN1cnJfZGF5KSxcbiAgICAgICAgICAgIGhhc19hY3Rpdml0eTogZmFsc2UsXG4gICAgICAgICAgICBjdXJyZW50OiBmYWxzZVxuXG4gICAgICAgICAgfVxuICAgICAgICAgIHkucHVzaChjdXJyX3QpO1xuICAgICAgICAgIG5leHRfZCsrO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGxldCBjdXJyX2RheSA9IG5ldyBEYXRlKHllYXIsIG1vbiAtIDEsIGQpO1xuICAgICAgICAgIGxldCBjdXJyX3QgPSB7XG4gICAgICAgICAgICBkOiBkLFxuICAgICAgICAgICAgZnVsbDogdGhpcy5kYXRlRm9ybWF0KCd5eXl5LU1NLWRkJywgY3Vycl9kYXkpLFxuICAgICAgICAgICAgc2hvdzogdGhpcy5kYXRlRm9ybWF0KCdNL2RkJywgY3Vycl9kYXkpLFxuICAgICAgICAgICAgbnVtOiB0aGlzLmRhdGVGb3JtYXQoJ2RkJywgY3Vycl9kYXkpLFxuICAgICAgICAgICAgaGFzX2FjdGl2aXR5OiBmYWxzZSxcbiAgICAgICAgICAgIGN1cnJlbnQ6IHRydWVcbiAgICAgICAgICB9XG4gICAgICAgICAgeS5wdXNoKGN1cnJfdCk7XG4gICAgICAgICAgZCsrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBzdCArPSBsZW47XG4gICAgICBybC5wdXNoKHkpO1xuICAgIH1cbiAgICByZXR1cm4gcmw7XG4gIH0sXG5cbiAgLyoqXG4gICAqIOiOt+WPluS4iuS4gOS4quaciOemu+e7k+adn+eahOS4pOWkqVxuICAgKlxuICAgKiBAZGF0ZSDmoLzlvI/kuLp5eXl5LW1tLWRk55qE5pel5pyf77yM5aaC77yaMjAxNC0wMS0yNVxuICAgKi9cbiAgZ2V0UHJlTW9udGgoZGF0ZSkge1xuICAgIHZhciBhcnIgPSBkYXRlLnNwbGl0KCctJyk7XG4gICAgdmFyIHllYXIgPSBhcnJbMF07IC8v6I635Y+W5b2T5YmN5pel5pyf55qE5bm05Lu9XG4gICAgdmFyIG1vbnRoID0gYXJyWzFdOyAvL+iOt+WPluW9k+WJjeaXpeacn+eahOaciOS7vVxuICAgIHZhciBkYXkgPSBhcnJbMl07IC8v6I635Y+W5b2T5YmN5pel5pyf55qE5pelXG4gICAgdmFyIGRheXMgPSBuZXcgRGF0ZSh5ZWFyLCBtb250aCwgMCk7XG4gICAgZGF5cyA9IGRheXMuZ2V0RGF0ZSgpOyAvL+iOt+WPluW9k+WJjeaXpeacn+S4reaciOeahOWkqeaVsFxuICAgIHZhciB5ZWFyMiA9IHllYXI7XG4gICAgdmFyIG1vbnRoMiA9IHBhcnNlSW50KG1vbnRoKSAtIDE7XG4gICAgaWYgKG1vbnRoMiA9PSAwKSB7XG4gICAgICB5ZWFyMiA9IHBhcnNlSW50KHllYXIyKSAtIDE7XG4gICAgICBtb250aDIgPSAxMjtcbiAgICB9XG4gICAgdmFyIGRheTIgPSBkYXk7XG4gICAgdmFyIGRheXMyID0gbmV3IERhdGUoeWVhcjIsIG1vbnRoMiwgMCk7XG4gICAgZGF5czIgPSBkYXlzMi5nZXREYXRlKCk7XG4gICAgaWYgKGRheTIgPiBkYXlzMikge1xuICAgICAgZGF5MiA9IGRheXMyO1xuICAgIH1cbiAgICBpZiAobW9udGgyIDwgMTApIHtcbiAgICAgIG1vbnRoMiA9ICcwJyArIG1vbnRoMjtcbiAgICB9XG4gICAgdmFyIHQyID0geWVhcjIgKyAnLScgKyBtb250aDIgKyAnLScgKyAxO1xuICAgIHJldHVybiB0MjtcbiAgfSxcblxuICAvKipcbiAgICog6I635Y+W5LiL5LiA5Liq5pyI56a757uT5p2f55qE5YmN5Lik5aSpXG4gICAqXG4gICAqIEBkYXRlIOagvOW8j+S4unl5eXktbW0tZGTnmoTml6XmnJ/vvIzlpoLvvJoyMDE0LTAxLTI1XG4gICAqL1xuICBnZXROZXh0TW9udGgoZGF0ZSkge1xuICAgIHZhciBhcnIgPSBkYXRlLnNwbGl0KCctJyk7XG4gICAgdmFyIHllYXIgPSBhcnJbMF07IC8v6I635Y+W5b2T5YmN5pel5pyf55qE5bm05Lu9XG4gICAgdmFyIG1vbnRoID0gYXJyWzFdOyAvL+iOt+WPluW9k+WJjeaXpeacn+eahOaciOS7vVxuICAgIHZhciBkYXkgPSBhcnJbMl07IC8v6I635Y+W5b2T5YmN5pel5pyf55qE5pelXG4gICAgdmFyIGRheXMgPSBuZXcgRGF0ZSh5ZWFyLCBtb250aCwgMCk7XG4gICAgZGF5cyA9IGRheXMuZ2V0RGF0ZSgpOyAvL+iOt+WPluW9k+WJjeaXpeacn+S4reeahOaciOeahOWkqeaVsFxuICAgIHZhciB5ZWFyMiA9IHllYXI7XG4gICAgdmFyIG1vbnRoMiA9IHBhcnNlSW50KG1vbnRoKSArIDE7XG4gICAgaWYgKG1vbnRoMiA9PSAxMykge1xuICAgICAgeWVhcjIgPSBwYXJzZUludCh5ZWFyMikgKyAxO1xuICAgICAgbW9udGgyID0gMTtcbiAgICB9XG4gICAgdmFyIGRheTIgPSBkYXk7XG4gICAgdmFyIGRheXMyID0gbmV3IERhdGUoeWVhcjIsIG1vbnRoMiwgMCk7XG4gICAgZGF5czIgPSBkYXlzMi5nZXREYXRlKCk7XG4gICAgaWYgKGRheTIgPiBkYXlzMikge1xuICAgICAgZGF5MiA9IGRheXMyO1xuICAgIH1cbiAgICBpZiAobW9udGgyIDwgMTApIHtcbiAgICAgIG1vbnRoMiA9ICcwJyArIG1vbnRoMjtcbiAgICB9XG4gICAgdmFyIHQyID0geWVhcjIgKyAnLScgKyBtb250aDIgKyAnLScgKyAxO1xuICAgIHJldHVybiB0MjtcbiAgfSxcblxuXG4gIC8v6I635Y+W5LiA5ZGo55qE5aSp5pWwXG4gIGdldE9uZU1vbnRoKGRhdGUpIHtcbiAgICB2YXIgY3VyRGF0ZSA9IG5ldyBEYXRlKCk7XG4gICAgLyog6I635Y+W5b2T5YmN5pyI5Lu9ICovXG4gICAgdmFyIGN1ck1vbnRoID0gY3VyRGF0ZS5nZXRNb250aCgpO1xuICAgIC8qIMKg55Sf5oiQ5a6e6ZmF55qE5pyI5Lu9OiDnlLHkuo5jdXJNb250aOS8muavlOWunumZheaciOS7veWwjzEsIOaVhemcgOWKoDEgKi9cbiAgICBjdXJEYXRlLnNldE1vbnRoKGN1ck1vbnRoICsgMSk7XG4gICAgLyog5bCG5pel5pyf6K6+572u5Li6MCwg6L+Z6YeM5Li65LuA5LmI6KaB6L+Z5qC36K6+572uLCDmiJHkuI3nn6XpgZPljp/lm6AsIOi/meaYr+S7jue9keS4iuWtpuadpeeahCAqL1xuICAgIGN1ckRhdGUuc2V0RGF0ZSgwKTtcbiAgICAvKiDov5Tlm57lvZPmnIjnmoTlpKnmlbAgKi9cbiAgICByZXR1cm4gY3VyRGF0ZS5nZXREYXRlKCk7XG4gIH0sXG5cbiAgLy/kuIDlkajml7bpl7TnmoTmr6vnp5LmlbBcbiAgZ2V0T25lV2Vla1RpbWUoKSB7XG4gICAgcmV0dXJuIDcgKiAyNCAqIDYwICogNjAgKiAxMDAwO1xuICB9LFxuXG4gIGdldERhdGVEaWZmKHN0YXJ0RGF0ZSwgZW5kRGF0ZSkge1xuICAgIHZhciBzdGFydFRpbWUgPSBuZXcgRGF0ZShEYXRlLnBhcnNlKHN0YXJ0RGF0ZS5yZXBsYWNlKC8tL2csIFwiL1wiKSkpLmdldFRpbWUoKTtcbiAgICB2YXIgZW5kVGltZSA9IG5ldyBEYXRlKERhdGUucGFyc2UoZW5kRGF0ZS5yZXBsYWNlKC8tL2csIFwiL1wiKSkpLmdldFRpbWUoKTtcbiAgICB2YXIgZGF0ZXMgPSBNYXRoLmFicygoc3RhcnRUaW1lIC0gZW5kVGltZSkpIC8gKDEwMDAgKiA2MCAqIDYwICogMjQpO1xuICAgIHJldHVybiBkYXRlcztcbiAgfSxcblxuICAvL+iuoeeul+W9k+WJjeaXtumXtOaIs+ebuOWvuSDlhbbku5bml7bpl7Tml7bpl7TmiLPlsI/ml7bliIbnp5LmlbBcbiAgY291bnRUaW1lTG9uZyh0aW1lc3RyYW1wX3N0YXJ0LCB0aW1lc3RyYW1wX2VuZCwgZG91YmxlKSB7XG4gICAgbGV0IG5vdyA9IHBhcnNlSW50KG5ldyBEYXRlKCkuZ2V0VGltZSgpIC8gMTAwMCk7XG4gICAgbGV0IGVuZCA9IHRpbWVzdHJhbXBfZW5kID8gdGltZXN0cmFtcF9lbmQgOiBub3c7XG4gICAgbGV0IGxvbmcgPSBlbmQgLSB0aW1lc3RyYW1wX3N0YXJ0O1xuXG4gICAgbGV0IGhvdXJzID0gcGFyc2VJbnQobG9uZyAvICg2MCAqIDYwKSk7XG5cbiAgICBsZXQgbWlucyA9IHBhcnNlSW50KChsb25nIC0gaG91cnMgKiA2MCAqIDYwKSAvIDYwKTtcbiAgICBsZXQgc2NlbiA9IGxvbmcgLSBob3VycyAqIDYwICogNjAgLSBtaW5zICogNjA7XG4gICAgaWYgKGRvdWJsZSkge1xuICAgICAgaWYgKGhvdXJzIDwgMTApIHtcbiAgICAgICAgaG91cnMgPSAnMCcgKyBob3Vyc1xuICAgICAgfVxuICAgICAgaWYgKG1pbnMgPCAxMCkge1xuICAgICAgICBtaW5zID0gJzAnICsgbWluc1xuICAgICAgfVxuICAgICAgaWYgKHNjZW4gPCAxMCkge1xuICAgICAgICBzY2VuID0gJzAnICsgc2NlblxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4ge1xuICAgICAgaDogaG91cnMsXG4gICAgICBtOiBtaW5zLFxuICAgICAgczogc2NlblxuICAgIH1cbiAgfVxufSJdfQ==